# Overview

この教材は、QuickCheckを中心としたテスト技法を軸に、Haskellでvim-likeなエディタを堅実に実装するための道筋を示します。コードとmdbookの解説が常にリンクするよう構成し、テストが設計そのものを導く流れを体験できるようにします。

## 目的

- Property-based testing (PBT) を中核に据え、バグの芽を仕様レベルで潰す感覚を身につける
- Haskellの型による制約を設計に反映させる
- TDDの短いサイクルとPBTの広い探索を組み合わせる
- 実装例が読み物と同期し、手元で再現できる状態を維持する

## 対象

vim-likeエディタの最小コアを題材にします。完全なvimを目指すのではなく、編集バッファ・カーソル・モード・コマンドの一連を、小さく検証可能な形で積み上げます。

## リポジトリの構成

- `src/` はmdbookの本文
- `app/` は実行バイナリの入口
- `src/Editor/` はエディタのコア実装
- `test/` はHspecとQuickCheckによるテスト

## 進め方

各章では、次の流れを繰り返します。

1. 仕様を言葉で明文化する
2. 型と小さな関数に落とす
3. 例示テストで期待値を固定する
4. PBTで性質を広く検証する
5. 実装を拡張し、モデルとテストを更新する

## 最初に見る「痛いバグ」

vim-likeエディタの実装でよく起きるのが「カーソルが範囲外に飛ぶ」問題です。例えば行削除の後にカーソルを更新し忘れると、次の操作で例外や見えない挙動につながります。

この教材では、次のような性質を最初に置きます。

```haskell
invariant editor =
  let rows = numLines (buffer editor)
      Cursor r c = cursor editor
  in rows > 0 && r >= 0 && r < rows && c >= 0 && c <= lineLength (buffer editor) r
```

この1本の性質があるだけで、行削除・改行・移動が絡むバグを早期に発見できます。まずは「PBTが効く痛み」を先に体験してもらうのが狙いです。
