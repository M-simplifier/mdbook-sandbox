# Domain Model

vim-likeエディタの最小モデルとして、次の要素を定義します。

- バッファ: 行の列 (空でない)
- カーソル: 行番号と列番号
- モード: Normal / Insert
- コマンド: 移動・挿入・削除・モード切替

## 不変条件 (Invariant)

- バッファの行数は1以上
- カーソル行はバッファの範囲内
- カーソル列は該当行の長さ以内

これらの不変条件をQuickCheckで保護します。特にカーソル範囲は、移動・挿入・削除で破れがちです。

## モードによる意味の違い

- Normal: 移動と行削除が有効、挿入系は無視される
- Insert: 文字挿入・削除・改行が有効、行削除は無視される

この「無視される」挙動も仕様としてテストに落とし込みます。

行削除をNormalのみに限定するのは、操作の意図を明確にするためです。Insertは「文字編集」に集中させ、構造的な変更はNormalで行う設計にすると、テストの分割も明確になります。

## モード別の操作一覧

| Command | Normal | Insert | 備考 |
| --- | --- | --- | --- |
| MoveLeft/Right/Up/Down | 有効 | 有効 | カーソル移動 |
| InsertChar | 無視 | 有効 | 文字挿入 |
| InsertNewline | 無視 | 有効 | 行分割 |
| Backspace | 無視 | 有効 | 1文字削除 |
| DeleteLine | 有効 | 無視 | 行削除 |
| EnterInsert | 有効 | 有効 | Insertへ |
| EnterNormal | 有効 | 有効 | Normalへ |

## 型設計の方向性

- `Buffer` は `NonEmpty Text` を使い、空バッファを型レベルで排除する
- `Cursor` は 0-based の `row` と `col`
- `Editor` は `buffer` と `cursor` と `mode`

型そのものが「空にならない」「位置が壊れない」ことを保証するわけではありませんが、設計上の意図がはっきりし、テストに落とし込みやすくなります。
